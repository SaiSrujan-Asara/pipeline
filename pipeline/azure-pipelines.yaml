trigger:
- main  # Replace 'main' with your branch name

pr:
- '*'

pool:
  vmImage: 'windows-latest'
  demands: Agent.OS -equals WinNT
  parallel: 1  # Set the maximum number of parallel jobs to 3

steps:
- script: |
    # Install Azure CLI
    curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

    # Authenticate with Azure
    az login --service-principal -u $(servicePrincipalId) -p $(servicePrincipalKey) --tenant $(tenantId)
    az account set --subscription $(subscriptionId)

    # Terraform setup and execution
    cd $(Build.SourcesDirectory)/path/to/terraform/code
    terraform init
    terraform plan -out=tfplan
    terraform apply -input=false -auto-approve tfplan
  displayName: 'Terraform Plan & Apply'
